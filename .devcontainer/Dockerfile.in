FROM %%ENVOY_BUILD_IMAGE%%

ARG USERNAME=envoybuild

ENV BUILD_DIR=/build

ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get -y update \
  && apt-get -y install --no-install-recommends python3 net-tools \
    iputils-ping procps psmisc vim openssh-client aspell 2>&1 \
  # [Optional] Add sudo support for non-root user
  && echo $USERNAME ALL=\(root\) NOPASSWD:ALL > /etc/sudoers.d/$USERNAME \
  && chmod 0440 /etc/sudoers.d/$USERNAME \
  # Create build directory and the volume will inherit the ownership
  && mv /home/$USERNAME $BUILD_DIR && chown $USERNAME:$USERNAME $BUILD_DIR \
  && usermod -d $BUILD_DIR $USERNAME

ENV DEBIAN_FRONTEND=
