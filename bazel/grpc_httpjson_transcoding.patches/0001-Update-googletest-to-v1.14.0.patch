From 7fe4b14d41fe6e7428771d098700140f7ad82704 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Alejandro=20R=20Sede=C3=B1o?= <asedeno@google.com>
Date: Sat, 14 Sep 2024 12:54:55 -0400
Subject: [PATCH 1/9] Update googletest to v1.14.0
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This should fix the build failures in oss-fuzz by dropping the use of
std::result_of, which was removed in C++20.

I didn't go with v1.15.0+ because that caused bazel to complain about
not having a @platforms//os:fuchsia target.

Signed-off-by: Alejandro R Sede√±o <asedeno@google.com>
---
 bazel/external/BUILD            | 15 ---------------
 bazel/external/googletest.patch | 13 -------------
 repositories.bzl                |  6 ++----
 3 files changed, 2 insertions(+), 32 deletions(-)
 delete mode 100644 bazel/external/BUILD
 delete mode 100644 bazel/external/googletest.patch

diff --git a/bazel/external/BUILD b/bazel/external/BUILD
deleted file mode 100644
index 26f0931..0000000
--- a/bazel/external/BUILD
+++ /dev/null
@@ -1,15 +0,0 @@
-# Copyright 2024 Google Inc. All Rights Reserved.
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#    http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
-#
-
diff --git a/bazel/external/googletest.patch b/bazel/external/googletest.patch
deleted file mode 100644
index 502ef58..0000000
--- a/bazel/external/googletest.patch
+++ /dev/null
@@ -1,13 +0,0 @@
-diff --git a/BUILD.bazel b/BUILD.bazel
-index 8099642a85..3598661079 100644
---- a/BUILD.bazel
-+++ b/BUILD.bazel
-@@ -40,7 +40,7 @@ exports_files(["LICENSE"])
-
- config_setting(
-     name = "windows",
--    constraint_values = ["@bazel_tools//platforms:windows"],
-+    constraint_values = ["@platforms//os:windows"],
- )
-
- config_setting(
diff --git a/repositories.bzl b/repositories.bzl
index 0e1c006..56d351c 100644
--- a/repositories.bzl
+++ b/repositories.bzl
@@ -103,8 +103,8 @@ def protobuf_repositories(bind = True):
         sha256 = PROTOBUF_SHA256,
     )
 
-GOOGLETEST_COMMIT = "703bd9caab50b139428cea1aaff9974ebee5742e"  # v1.10.0: Oct 2, 2019
-GOOGLETEST_SHA256 = "d17b1b83a57b3933565a6d0616fe261107326d47de20288d0949ed038e1c342d"
+GOOGLETEST_COMMIT = "f8d7d77c06936315286eb55f8de22cd23c188571"  # v1.14.0: Aug 2, 2023
+GOOGLETEST_SHA256 = "7ff5db23de232a39cbb5c9f5143c355885e30ac596161a6b9fc50c4538bfbf01"
 
 def googletest_repositories(bind = True):
     http_archive(
@@ -112,8 +112,6 @@ def googletest_repositories(bind = True):
         strip_prefix = "googletest-" + GOOGLETEST_COMMIT,
         url = "https://github.com/google/googletest/archive/" + GOOGLETEST_COMMIT + ".tar.gz",
         sha256 = GOOGLETEST_SHA256,
-        patches = ["@grpc-httpjson-transcoding//bazel/external:googletest.patch"],
-        patch_args = ["-p1"],
     )
 
 GOOGLEAPIS_COMMIT = "1d5522ad1056f16a6d593b8f3038d831e64daeea"  # Sept 03, 2020
-- 
2.46.0.662.g92d0881bb0-goog

