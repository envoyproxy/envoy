diff --git a/google3/third_party/envoy/src/test/common/formatter/substitution_formatter_test.cc b/google3/third_party/envoy/src/test/common/formatter/substitution_formatter_test.cc
--- a/google3/third_party/envoy/src/test/common/formatter/substitution_formatter_test.cc
+++ b/google3/third_party/envoy/src/test/common/formatter/substitution_formatter_test.cc
@@ -1150,7 +1150,8 @@ TEST(SubstitutionFormatterTest, streamIn
     StreamInfoFormatter us_close_type_format("UPSTREAM_DETECTED_CLOSE_TYPE");
     stream_info.upstreamInfo()->setUpstreamDetectedCloseType(StreamInfo::DetectedCloseType::Normal);
     EXPECT_EQ("Normal", us_close_type_format.format({}, stream_info));
-    stream_info.upstreamInfo()->setUpstreamDetectedCloseType(StreamInfo::DetectedCloseType::LocalReset);
+    stream_info.upstreamInfo()->setUpstreamDetectedCloseType(
+        StreamInfo::DetectedCloseType::LocalReset);
     EXPECT_EQ("LocalReset", us_close_type_format.format({}, stream_info));
     stream_info.upstreamInfo()->setUpstreamDetectedCloseType(
         StreamInfo::DetectedCloseType::RemoteReset);
diff --git a/google3/third_party/envoy/src/test/mocks/stream_info/mocks.cc b/google3/third_party/envoy/src/test/mocks/stream_info/mocks.cc
--- a/google3/third_party/envoy/src/test/mocks/stream_info/mocks.cc
+++ b/google3/third_party/envoy/src/test/mocks/stream_info/mocks.cc
@@ -77,6 +77,13 @@ MockUpstreamInfo::MockUpstreamInfo()
   }));
   ON_CALL(*this, upstreamProtocol()).WillByDefault(ReturnPointee(&upstream_protocol_));
   ON_CALL(*this, upstreamRemoteAddress()).WillByDefault(ReturnRef(upstream_remote_address_));
+  ON_CALL(*this, setUpstreamDetectedCloseType(_))
+      .WillByDefault(Invoke([this](DetectedCloseType close_type) {
+        upstream_detected_close_type_ = close_type;
+      }));
+  ON_CALL(*this, upstreamDetectedCloseType()).WillByDefault(Invoke([this]() {
+    return upstream_detected_close_type_;
+  }));
 }
 
 MockUpstreamInfo::~MockUpstreamInfo() = default;
@@ -211,6 +218,13 @@ MockStreamInfo::MockStreamInfo()
       }));
   ON_CALL(*this, downstreamLocalCloseReason())
       .WillByDefault(ReturnPointee(&downstream_local_close_reason_));
+  ON_CALL(*this, setDownstreamDetectedCloseType(_))
+      .WillByDefault(Invoke([this](DetectedCloseType close_type) {
+        downstream_detected_close_type_ = close_type;
+      }));
+  ON_CALL(*this, downstreamDetectedCloseType()).WillByDefault(Invoke([this]() {
+    return downstream_detected_close_type_;
+  }));
   ON_CALL(*this, setUpstreamClusterInfo(_))
       .WillByDefault(Invoke([this](const Upstream::ClusterInfoConstSharedPtr& cluster_info) {
         upstream_cluster_info_ = std::move(cluster_info);
diff --git a/google3/third_party/envoy/src/test/mocks/stream_info/mocks.h b/google3/third_party/envoy/src/test/mocks/stream_info/mocks.h
--- a/google3/third_party/envoy/src/test/mocks/stream_info/mocks.h
+++ b/google3/third_party/envoy/src/test/mocks/stream_info/mocks.h
@@ -87,6 +87,7 @@ public:
   Network::Address::InstanceConstSharedPtr upstream_remote_address_;
   std::string failure_reason_;
   std::string local_close_reason_;
+  DetectedCloseType upstream_detected_close_type_ = DetectedCloseType::Normal;
   Upstream::HostDescriptionConstSharedPtr upstream_host_;
   FilterStateSharedPtr filter_state_;
   uint64_t num_streams_ = 0;
@@ -213,6 +214,7 @@ public:
   DownstreamTiming downstream_timing_;
   std::string downstream_transport_failure_reason_;
   std::string downstream_local_close_reason_;
+  DetectedCloseType downstream_detected_close_type_ = DetectedCloseType::Normal;
   std::string stream_flags_;
   Router::VirtualHostConstSharedPtr virtual_host_;
 };
