syntax = "proto3";

package envoy.extensions.sse_content_parsers.json.v3;

import "envoy/extensions/filters/http/json_to_metadata/v3/json_to_metadata.proto";

import "udpa/annotations/status.proto";
import "validate/validate.proto";

option java_package = "io.envoyproxy.envoy.extensions.sse_content_parsers.json.v3";
option java_outer_classname = "JsonContentParserProto";
option java_multiple_files = true;
option go_package = "github.com/envoyproxy/go-control-plane/envoy/extensions/sse_content_parsers/json/v3;jsonv3";
option (udpa.annotations.file_status).package_version_status = ACTIVE;

// [#protodoc-title: JSON Content Parser for SSE]
//
// Parses JSON data from individual SSE events and extracts values using JSON path selectors.
// This parser is designed to work with the SSE-To-Metadata filter and
// processes each SSE event's data field independently.
//
// [#extension: envoy.sse_content_parsers.json]

// Configuration for the JSON content parser.
// [#next-free-field: 3]
message JsonContentParser {
  // The rules to apply for extracting values from JSON in SSE events.
  // Rules are evaluated in order for each event.
  // At least one rule must be specified.
  repeated envoy.extensions.filters.http.json_to_metadata.v3.JsonToMetadata.Rule rules = 1
      [(validate.rules).repeated = {min_items: 1}];

  // If true, stop processing the stream after the first rule successfully matches (on_present executes).
  // This picks the first occurrence and is efficient when you know the desired value
  // appears early in the stream (e.g., extracting a model name from the first SSE event).
  //
  // If false (default), continue processing the entire stream. Later matches will overwrite
  // earlier ones (unless preserve_existing_metadata_value is true), effectively picking the LAST occurrence.
  //
  // Note: This applies to the first matching rule. on_missing and on_error do not trigger stopping.
  bool stop_processing_on_first_match = 2;
}
