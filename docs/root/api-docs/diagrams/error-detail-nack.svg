<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="835" height="678" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[participant Envoy as C
participant Management Server as S

C->S: {resource_names={A}}
S->C: {resources={A}, version=1, nonce=1}
C->S: {resource_names={A}, version=1, nonce=1 (this is an ACK)}
Note over C: adding subscription\nto B
C->S: {resource_names={A, B}, version=1, nonce=1}
Note over S: sends B, but system version\ndoes not change because\nserver has not gotten a\nnew config
S->C: {resources={B}, version=1, nonce=2}
Note over C: intending to NACK B
C->S: {resource_names={A, B}, version=1, nonce=2, error_detail="B is invalid"}
Note over S: needs to look at error_detail\nto detect NACK instead of\n using version and nonce
]]></source><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with RaphaÃ«l 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock55-objtaa90" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-objkts7d" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj1uixv" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-objzekzs" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-objd0fxf" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock55-obj3d7fg" markerHeight="5" markerWidth="5" orient="auto" refX="2.5" refY="2.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 2.5 2.5) scale(1,1)" stroke-width="1.0000" fill="#000" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="55.8671875" y="20" width="62.421875" height="38.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="66.015625" y="30" width="42.421875" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="87.078125" y="39.296875" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Envoy</tspan></text><rect x="55.8671875" y="619.703125" width="62.421875" height="38.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="66.015625" y="629.703125" width="42.421875" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="87.078125" y="639" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Envoy</tspan></text><path fill="none" stroke="#000000" d="M87.078125,58.59375L87.078125,619.703125" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="527.5859375" y="20" width="163.484375" height="38.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="537.734375" y="30" width="143.484375" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="609.328125" y="39.296875" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Management Server</tspan></text><rect x="527.5859375" y="619.703125" width="163.484375" height="38.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="537.734375" y="629.703125" width="143.484375" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="609.328125" y="639" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Management Server</tspan></text><path fill="none" stroke="#000000" d="M609.328125,58.59375L609.328125,619.703125" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="269.015625" y="74.296875" width="158.375" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="348.203125" y="83.59375" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resource_names={A}}</tspan></text><path fill="none" stroke="#000000" d="M87.078125,97.1875C87.078125,97.1875,550.880707025528,97.1875,604.3267076886259,97.1875" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objtaa90)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="220.15625" y="112.890625" width="256.09375" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="348.203125" y="122.1875" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resources={A}, version=1, nonce=1}</tspan></text><path fill="none" stroke="#000000" d="M609.328125,135.78125C609.328125,135.78125,145.52554297447205,135.78125,92.0795423113741,135.78125" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objkts7d)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="139.859375" y="151.484375" width="416.6875" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="348.203125" y="160.78125" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resource_names={A}, version=1, nonce=1 (this is an ACK)}</tspan></text><path fill="none" stroke="#000000" d="M87.078125,174.375C87.078125,174.375,550.880707025528,174.375,604.3267076886259,174.375" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj1uixv)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="11.890625" y="194.375" width="150.375" height="47.78125" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="16.890625" y="199.375" width="140.375" height="37.78125" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="87.078125" y="218.265625" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="-4.6015625" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">adding subscription</tspan><tspan dy="19.2" x="87.078125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">to B</tspan></text><rect x="188.015625" y="257.859375" width="320.375" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="348.203125" y="267.15625" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resource_names={A, B}, version=1, nonce=1}</tspan></text><path fill="none" stroke="#000000" d="M87.078125,280.75C87.078125,280.75,550.880707025528,280.75,604.3267076886259,280.75" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objzekzs)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="505.25" y="300.75" width="208.15625" height="86.1875" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="510.25" y="305.75" width="198.15625" height="76.1875" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="609.328125" y="343.84375" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="-23.796875" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">sends B, but system version</tspan><tspan dy="19.2" x="609.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">does not change because</tspan><tspan dy="19.2" x="609.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">server has not gotten a</tspan><tspan dy="19.2" x="609.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">new config</tspan></text><rect x="220.40625" y="402.640625" width="255.59375" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="348.203125" y="411.9375" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resources={B}, version=1, nonce=2}</tspan></text><path fill="none" stroke="#000000" d="M609.328125,425.53125C609.328125,425.53125,145.52554297447205,425.53125,92.0795423113741,425.53125" stroke-width="2" marker-end="url(#raphael-marker-endblock55-objd0fxf)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="10" y="445.53125" width="154.15625" height="28.59375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="15" y="450.53125" width="144.15625" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="87.078125" y="459.828125" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">intending to NACK B</tspan></text><rect x="97.078125" y="489.828125" width="502.25" height="18.59375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="348.203125" y="499.125" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">{resource_names={A, B}, version=1, nonce=2, error_detail="B is invalid"}</tspan></text><path fill="none" stroke="#000000" d="M87.078125,512.71875C87.078125,512.71875,550.880707025528,512.71875,604.3267076886259,512.71875" stroke-width="2" marker-end="url(#raphael-marker-endblock55-obj3d7fg)" stroke-dasharray="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><rect x="505.765625" y="532.71875" width="207.125" height="66.984375" rx="0" ry="0" fill="none" stroke="#000000" stroke-width="2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><rect x="510.765625" y="537.71875" width="197.125" height="56.984375" rx="0" ry="0" fill="#ffffff" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><text x="609.328125" y="566.2109375" text-anchor="middle" font-family="Roboto" font-size="16px" stroke="none" fill="#000000" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font-family: Roboto; font-size: 16px;"><tspan dy="-14.203125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">needs to look at error_detail</tspan><tspan dy="19.2" x="609.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">to detect NACK instead of</tspan><tspan dy="19.2" x="609.328125" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"> using version and nonce</tspan></text></svg>
