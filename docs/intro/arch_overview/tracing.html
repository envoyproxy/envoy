

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tracing &mdash; envoy 1.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="envoy 1.0.0 documentation" href="../../index.html"/>
        <link rel="up" title="Architecture overview" href="arch_overview.html"/>
        <link rel="next" title="TCP proxy" href="tcp_proxy.html"/>
        <link rel="prev" title="Runtime configuration" href="runtime.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> envoy
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about_docs.html">About the documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../intro.html">Introduction</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../what_is_envoy.html">What is Envoy</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="arch_overview.html">Architecture overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="threading_model.html">Threading model</a></li>
<li class="toctree-l3"><a class="reference internal" href="listeners.html">Listeners</a></li>
<li class="toctree-l3"><a class="reference internal" href="network_filters.html">Network (L3/L4) filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="http_connection_management.html">HTTP connection management</a></li>
<li class="toctree-l3"><a class="reference internal" href="http_filters.html">HTTP filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="http_routing.html">HTTP routing</a></li>
<li class="toctree-l3"><a class="reference internal" href="grpc.html">gRPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_manager.html">Cluster manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="service_discovery.html">Service discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="health_checking.html">Health checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="connection_pooling.html">Connection pooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="load_balancing.html">Load balancing</a></li>
<li class="toctree-l3"><a class="reference internal" href="circuit_breaking.html">Circuit breaking</a></li>
<li class="toctree-l3"><a class="reference internal" href="global_rate_limiting.html">Global rate limiting</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssl.html">TLS</a></li>
<li class="toctree-l3"><a class="reference internal" href="statistics.html">Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="runtime.html">Runtime configuration</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Tracing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-initiate-a-trace">How to initiate a trace</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-data-each-trace-contains">What data each trace contains</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tcp_proxy.html">TCP proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="mongo.html">MongoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamo.html">DynamoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="hot_restart.html">Hot restart</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../deployment_types/deployment_types.html">Deployment types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../real_world_deployments.html">Real world deployments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../comparison.html">Comparison to similar systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_help.html">Getting help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../version_history.html">Version history</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Building and installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/configuration.html">Configuration reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/operations.html">Operations and administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extending/extending.html">Extending Envoy for custom use cases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">envoy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../intro.html">Introduction</a> &raquo;</li>
      
          <li><a href="arch_overview.html">Architecture overview</a> &raquo;</li>
      
    <li>Tracing</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/intro/arch_overview/tracing.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tracing">
<span id="arch-overview-tracing"></span><h1>Tracing<a class="headerlink" href="#tracing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Distributed tracing allows developers to obtain visualizations of call flows in large service
oriented architectures. It can be invaluable in understanding serialization, parallelism, and
sources of latency. Envoy supports three features related to system wide tracing:</p>
<ul class="simple">
<li><strong>Request ID generation</strong>: Envoy will generate UUIDs when needed and populate the
<a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-x-request-id"><span class="std std-ref">x-request-id</span></a> HTTP header. Applications can forward the
x-request-id header for unified logging as well as tracing.</li>
<li><strong>External trace service integration</strong>: Envoy supports pluggable external trace visualization
providers. Currently the only supported provider is for <a class="reference external" href="http://lightstep.com/">LightStep</a>.
However other providers for systems such as <a class="reference external" href="http://zipkin.io/">Zipkin</a> or <a class="reference external" href="http://opentracing.io/">OpenTracing</a> would not be difficult to add.</li>
<li><strong>Client trace ID joining</strong>: The <a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-x-client-trace-id"><span class="std std-ref">x-client-trace-id</span></a> header can
be used to join untrusted request IDs to the trusted internal
<a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-x-request-id"><span class="std std-ref">x-request-id</span></a>.</li>
</ul>
</div>
<div class="section" id="how-to-initiate-a-trace">
<h2>How to initiate a trace<a class="headerlink" href="#how-to-initiate-a-trace" title="Permalink to this headline">¶</a></h2>
<p>The HTTP connection manager that handles the request must have the <a class="reference internal" href="../../configuration/http_conn_man/http_conn_man.html#config-http-conn-man-tracing-enabled"><span class="std std-ref">tracing_enabled</span></a> option set. There are several ways tracing can be
initiated:</p>
<ul class="simple">
<li>By an external client via the <a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-x-client-trace-id"><span class="std std-ref">x-client-trace-id</span></a>
header.</li>
<li>By an internal service via the <a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-x-envoy-force-trace"><span class="std std-ref">x-envoy-force-trace</span></a>
header.</li>
<li>Randomly sampled via the <a class="reference internal" href="../../configuration/http_conn_man/runtime.html#config-http-conn-man-runtime-random-sampling"><span class="std std-ref">random_sampling</span></a>
runtime setting.</li>
</ul>
</div>
<div class="section" id="what-data-each-trace-contains">
<h2>What data each trace contains<a class="headerlink" href="#what-data-each-trace-contains" title="Permalink to this headline">¶</a></h2>
<p>Traces from every service are aggregated using the <a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-x-request-id"><span class="std std-ref">x-request-id</span></a>
HTTP request header. Envoy automatically sends spans which compose a trace to tracing collectors. A
span represents a logical unit of work that has a start time and duration and can contain metadata
associated with it. Each Envoy span contains the following data:</p>
<ul class="simple">
<li>Originating service cluster set via <a class="reference internal" href="../../operations/cli.html#cmdoption--service-cluster"><code class="xref std std-option docutils literal"><span class="pre">--service-cluster</span></code></a>.</li>
<li>Start time and duration of the request.</li>
<li>Originating host set via <a class="reference internal" href="../../operations/cli.html#cmdoption--service-node"><code class="xref std std-option docutils literal"><span class="pre">--service-node</span></code></a>.</li>
<li>Downstream cluster set via the <a class="reference internal" href="../../configuration/http_conn_man/headers.html#config-http-conn-man-headers-downstream-service-cluster"><span class="std std-ref">x-envoy-downstream-service-cluster</span></a>
header.</li>
<li>HTTP request line.</li>
<li>HTTP response code.</li>
</ul>
<p>Tracing <a class="reference internal" href="../../configuration/overview/tracing.html#config-tracing"><span class="std std-ref">configuration</span></a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tcp_proxy.html" class="btn btn-neutral float-right" title="TCP proxy" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="runtime.html" class="btn btn-neutral" title="Runtime configuration" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Lyft.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>